{% extends "base.html" %}

{% block content %}
<style>
    .assessments-container {
        max-height: 160px;
        overflow-y: auto;
    }
</style>

<div class="container mt-5 text-center">
    <div class="row align-items-stretch">
        <!-- Profile Card -->
        <div class="col-md-4">
            <div class="card shadow-sm mb-4">
                <div class="card-body text-center">
                    <h4 class="card-title mb-3">{{name}}</h4>
                    <p class="mb-1"><strong>Age: </strong>52</p>
                    <p class="mb-1"><strong>Gender: </strong>Male</p>
                    <p class="mb-1"><strong>Height: </strong>185 cm</p>
                    <p class="mb-1"><strong>Weight: </strong>102 kg</p>
                    <p class="mb-1"><strong>Diagnosis: </strong>TBD</p>
                </div>
            </div>
        </div>
    
         <!-- Past Assessments Details -->
        <div class="col-md-8 d-flex flex-column">
            <h4 class="mb-3">Past Assessments</h4>
            <div class="assessments-container border rounded">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Test Type</th>
                            <th>Score</th>
                            <th>Avg Reaction Time (ms)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if results %}
                            {% for r in results %}
                                <tr>
                                    <td>{{ r.date_taken.strftime("%Y-%m-%d %H:%M") }}</td>
                                    <td>Short-Term Memory Test</td>
                                    <td>{{ r.score }}/{{ r.total_rounds }}</td>
                                    <td>{{ "%.2f"|format(r.avg_reaction_time) }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4">No past assessments found.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

     <!-- Charts -->
    <div class="container mt-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <h3 class="card-title mb-4 text-center">Assessment Charts</h3>
                <div class="row">
                    <!-- Memory Score Chart-->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="mb-2">Memory Scores Over Time</h5>
                                <canvas id="scoreChart" style="max-height:400px;"></canvas>
                            </div>
                        </div>
                    </div>

                 <!-- Reaction Time Chart-->
                 <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="mb-2">Reaction Times Over Time</h5>
                            <canvas id="reactionChart" style="max-height:400px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Need to convert Flask lists to JS arrays
    const labels = {{ chart_labels|tojson }};
    const scores = {{ chart_scores|tojson }};
    const reactionTimes = {{ chart_reaction_times|tojson }};

    // Memory chart
    new Chart(document.getElementById('scoreChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Memory Score(s)',
                data: scores,
                borderColor: 'rgb(54, 162, 235)',
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: { y: { title: { display: true, text: 'Score' }}}
        }
    });

    // Reaction Time chart
    new Chart(document.getElementById('reactionChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Reaction Time (ms)',
                data: reactionTimes,
                borderColor: 'rgb(54, 162, 235)',
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: { y: { title: { display: true, text: 'Time (ms)' }}}
        }
    });

</script>
{% endblock %}